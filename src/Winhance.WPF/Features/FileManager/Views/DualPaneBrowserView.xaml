<UserControl x:Class="Winhance.WPF.Features.FileManager.Views.DualPaneBrowserView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:viewModels="clr-namespace:Winhance.WPF.Features.FileManager.ViewModels"
  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks" d:DataContext="{d:DesignInstance Type=viewModels:DualPaneBrowserViewModel}" mc:Ignorable="d">

  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*" />
      <ColumnDefinition Width="5" />
      <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>

    <!-- Left Pane -->
    <Border Grid.Column="0" Background="{DynamicResource CardBackground}" CornerRadius="8" Margin="0,0,2,0">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Left Pane Toolbar -->
        <Border Grid.Row="0" Background="{DynamicResource MainContainerBorderBrush}" CornerRadius="8,8,0,0" Padding="8">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Back Button -->
            <Button Grid.Column="0" Width="32" Height="32" Command="{Binding GoBackLeftCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Go Back">
              <iconPacks:PackIconMaterial Kind="ArrowLeft" Width="16" Height="16" />
            </Button>

            <!-- Up Button -->
            <Button Grid.Column="1" Width="32" Height="32" Margin="4,0,0,0" Command="{Binding NavigateUpLeftCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Go Up">
              <iconPacks:PackIconMaterial Kind="ArrowUp" Width="16" Height="16" />
            </Button>

            <!-- Refresh Button -->
            <Button Grid.Column="2" Width="32" Height="32" Margin="4,0,0,0" Command="{Binding LoadLeftPaneCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Refresh">
              <iconPacks:PackIconMaterial Kind="Refresh" Width="16" Height="16" />
            </Button>

            <!-- Path Display -->
            <TextBox Grid.Column="3" Text="{Binding LeftPanePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,0,0" VerticalContentAlignment="Center" FontSize="13" Background="{DynamicResource CardBackground}" Foreground="{DynamicResource PrimaryTextColor}" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}" />
          </Grid>
        </Border>

        <!-- Drive Selector -->
        <Border Grid.Row="1" Background="{DynamicResource CardBackground}" Padding="8,4">
          <ItemsControl ItemsSource="{Binding Drives}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Button Content="{Binding Name}" MinWidth="50" Height="28" Margin="0,0,4,0" Command="{Binding DataContext.NavigateLeftCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding Name}" Style="{DynamicResource DriveButtonStyle}" ToolTip="{Binding SpaceDisplay}" />
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </Border>

        <!-- File List -->
        <ListView Grid.Row="2" ItemsSource="{Binding LeftPaneItems}" SelectedItem="{Binding SelectedLeftItem}" Background="Transparent" BorderThickness="0" SelectionMode="Extended" VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.VirtualizationMode="Recycling">
          <ListView.InputBindings>
            <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding NavigateLeftCommand}" CommandParameter="{Binding SelectedLeftItem.FullPath}" />
          </ListView.InputBindings>
          <ListView.View>
            <GridView>
              <GridViewColumn Header="" Width="30">
                <GridViewColumn.CellTemplate>
                  <DataTemplate>
                    <iconPacks:PackIconMaterial Kind="{Binding Icon}" Width="16" Height="16" Foreground="{DynamicResource PrimaryTextColor}" />
                  </DataTemplate>
                </GridViewColumn.CellTemplate>
              </GridViewColumn>
              <GridViewColumn Header="Name" Width="200" DisplayMemberBinding="{Binding Name}" />
              <GridViewColumn Header="Size" Width="80" DisplayMemberBinding="{Binding SizeDisplay}" />
              <GridViewColumn Header="Modified" Width="130" DisplayMemberBinding="{Binding DateModified, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" />
            </GridView>
          </ListView.View>
        </ListView>
      </Grid>
    </Border>

    <!-- Splitter -->
    <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="{DynamicResource MainContainerBorderBrush}" />

    <!-- Right Pane -->
    <Border Grid.Column="2" Background="{DynamicResource CardBackground}" CornerRadius="8" Margin="2,0,0,0">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Right Pane Toolbar -->
        <Border Grid.Row="0" Background="{DynamicResource MainContainerBorderBrush}" CornerRadius="8,8,0,0" Padding="8">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Width="32" Height="32" Command="{Binding GoBackRightCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Go Back">
              <iconPacks:PackIconMaterial Kind="ArrowLeft" Width="16" Height="16" />
            </Button>

            <Button Grid.Column="1" Width="32" Height="32" Margin="4,0,0,0" Command="{Binding NavigateUpRightCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Go Up">
              <iconPacks:PackIconMaterial Kind="ArrowUp" Width="16" Height="16" />
            </Button>

            <Button Grid.Column="2" Width="32" Height="32" Margin="4,0,0,0" Command="{Binding LoadRightPaneCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Refresh">
              <iconPacks:PackIconMaterial Kind="Refresh" Width="16" Height="16" />
            </Button>

            <TextBox Grid.Column="3" Text="{Binding RightPanePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,0,0" VerticalContentAlignment="Center" FontSize="13" Background="{DynamicResource CardBackground}" Foreground="{DynamicResource PrimaryTextColor}" BorderThickness="1" BorderBrush="{DynamicResource BorderBrush}" />
          </Grid>
        </Border>

        <!-- Drive Selector -->
        <Border Grid.Row="1" Background="{DynamicResource CardBackground}" Padding="8,4">
          <ItemsControl ItemsSource="{Binding Drives}">
            <ItemsControl.ItemsPanel>
              <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" />
              </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
              <DataTemplate>
                <Button Content="{Binding Name}" MinWidth="50" Height="28" Margin="0,0,4,0" Command="{Binding DataContext.NavigateRightCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding Name}" Style="{DynamicResource DriveButtonStyle}" ToolTip="{Binding SpaceDisplay}" />
              </DataTemplate>
            </ItemsControl.ItemTemplate>
          </ItemsControl>
        </Border>

        <!-- File List -->
        <ListView Grid.Row="2" ItemsSource="{Binding RightPaneItems}" SelectedItem="{Binding SelectedRightItem}" Background="Transparent" BorderThickness="0" SelectionMode="Extended" VirtualizingPanel.IsVirtualizing="True" VirtualizingPanel.VirtualizationMode="Recycling">
          <ListView.InputBindings>
            <MouseBinding MouseAction="LeftDoubleClick" Command="{Binding NavigateRightCommand}" CommandParameter="{Binding SelectedRightItem.FullPath}" />
          </ListView.InputBindings>
          <ListView.View>
            <GridView>
              <GridViewColumn Header="" Width="30">
                <GridViewColumn.CellTemplate>
                  <DataTemplate>
                    <iconPacks:PackIconMaterial Kind="{Binding Icon}" Width="16" Height="16" Foreground="{DynamicResource PrimaryTextColor}" />
                  </DataTemplate>
                </GridViewColumn.CellTemplate>
              </GridViewColumn>
              <GridViewColumn Header="Name" Width="200" DisplayMemberBinding="{Binding Name}" />
              <GridViewColumn Header="Size" Width="80" DisplayMemberBinding="{Binding SizeDisplay}" />
              <GridViewColumn Header="Modified" Width="130" DisplayMemberBinding="{Binding DateModified, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" />
            </GridView>
          </ListView.View>
        </ListView>
      </Grid>
    </Border>

    <!-- Action Buttons (Bottom Center) -->
    <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,100,0,0">
      <Button Width="40" Height="40" Margin="0,5" Command="{Binding CopyToOtherPaneCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Copy to other pane">
        <iconPacks:PackIconMaterial Kind="ContentCopy" Width="20" Height="20" />
      </Button>
      <Button Width="40" Height="40" Margin="0,5" Command="{Binding MoveToOtherPaneCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Move to other pane">
        <iconPacks:PackIconMaterial Kind="ArrowRightBold" Width="20" Height="20" />
      </Button>
      <Button Width="40" Height="40" Margin="0,5" Command="{Binding DeleteSelectedCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="Delete selected">
        <iconPacks:PackIconMaterial Kind="Delete" Width="20" Height="20" />
      </Button>
      <Button Width="40" Height="40" Margin="0,5" Command="{Binding CreateNewFolderCommand}" Style="{DynamicResource IconButtonStyle}" ToolTip="New folder">
        <iconPacks:PackIconMaterial Kind="FolderPlus" Width="20" Height="20" />
      </Button>
    </StackPanel>
  </Grid>
</UserControl>
