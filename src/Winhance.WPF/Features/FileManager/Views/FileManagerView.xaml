<UserControl x:Class="Winhance.WPF.Features.FileManager.Views.FileManagerView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:viewModels="clr-namespace:Winhance.WPF.Features.FileManager.ViewModels"
  xmlns:views="clr-namespace:Winhance.WPF.Features.FileManager.Views"
  xmlns:commonControls="clr-namespace:Winhance.WPF.Features.Common.Controls"
  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks" d:DataContext="{d:DesignInstance Type=viewModels:FileManagerViewModel}" mc:Ignorable="d">

  <UserControl.Resources>
    <DataTemplate x:Key="BrowserViewTemplate" DataType="{x:Type viewModels:DualPaneBrowserViewModel}">
      <views:DualPaneBrowserView />
    </DataTemplate>
    <DataTemplate x:Key="BatchRenameViewTemplate" DataType="{x:Type viewModels:BatchRenameViewModel}">
      <views:BatchRenameView />
    </DataTemplate>
    <DataTemplate x:Key="OrganizerViewTemplate" DataType="{x:Type viewModels:OrganizerViewModel}">
      <views:OrganizerView />
    </DataTemplate>
  </UserControl.Resources>

  <Grid>
    <!-- Header -->
    <Grid x:Name="HeaderGrid" Height="80" VerticalAlignment="Top" ClipToBounds="False">
      <Viewbox Stretch="Uniform" StretchDirection="DownOnly" HorizontalAlignment="Stretch">
        <Grid Width="{Binding ActualWidth, ElementName=HeaderGrid}" MinWidth="1250" MinHeight="80">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <!-- Icon -->
          <iconPacks:PackIconMaterial Grid.Column="0" Kind="FolderMultiple" Width="60" Height="60" Margin="10,0,10,0" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />

          <!-- Title and Status -->
          <StackPanel Grid.Column="1" VerticalAlignment="Center">
            <TextBlock Height="35" VerticalAlignment="Top" FontFamily="Helvetica Neue" FontSize="32" FontWeight="Bold" Foreground="{DynamicResource PrimaryTextColor}" Text="File Manager" />

            <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
              <TextBlock Height="22" VerticalAlignment="Center" FontFamily="Helvetica Neue" FontSize="14" Foreground="{DynamicResource SubTextColor}" Text="{Binding StatusMessage}" />
            </StackPanel>
          </StackPanel>

          <!-- Buttons and Search -->
          <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,10,10">

            <!-- Refresh Button -->
            <Button Content="Refresh" MinWidth="90" Height="35" Margin="0,0,5,0" Command="{Binding RefreshCommand}" Style="{DynamicResource RefreshButtonStyle}">
              <Button.ToolTip>
                <TextBlock Text="Refresh current view" />
              </Button.ToolTip>
            </Button>

            <!-- Separator -->
            <Border Width="1" Height="28" Background="#505050" VerticalAlignment="Center" Margin="0,0,10,0" />

            <!-- Help Button -->
            <Button Content="Help" MinWidth="60" Height="35" Margin="0,0,10,0" Command="{Binding ShowHelpCommand}" Style="{DynamicResource HelpButtonStyle}" />

            <!-- Search Box -->
            <commonControls:SearchBox Width="200" HorizontalAlignment="Right" VerticalAlignment="Center" SearchText="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
          </StackPanel>
        </Grid>
      </Viewbox>
    </Grid>

    <!-- Main Content -->
    <Border Margin="0,85,0,0" Background="{DynamicResource MainContainerBorderBrush}" CornerRadius="10">
      <Grid>
        <!-- Tab Header Section -->
        <Border Height="60" VerticalAlignment="Top" Background="{DynamicResource MainContainerBorderBrush}" CornerRadius="10,10,0,0" Padding="15,10,15,10" Panel.ZIndex="100">
          <Grid>
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Browser Tab -->
            <Border Grid.Column="0" Cursor="Hand" Background="Transparent" CornerRadius="5" Margin="5,0">
              <Border.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding SelectBrowserTabCommand}" />
              </Border.InputBindings>
              <Border.Style>
                <Style TargetType="Border">
                  <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </Trigger>
                    <DataTrigger Binding="{Binding IsBrowserTabSelected}" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="15,8">
                <iconPacks:PackIconMaterial Kind="FolderOpen" Width="20" Height="20" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
                <TextBlock Text="File Browser" FontSize="14" FontWeight="SemiBold" Margin="8,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
              </StackPanel>
            </Border>

            <!-- Separator -->
            <Border Grid.Column="1" Width="1" Height="30" Background="#404040" />

            <!-- Batch Rename Tab -->
            <Border Grid.Column="2" Cursor="Hand" Background="Transparent" CornerRadius="5" Margin="5,0">
              <Border.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding SelectBatchRenameTabCommand}" />
              </Border.InputBindings>
              <Border.Style>
                <Style TargetType="Border">
                  <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </Trigger>
                    <DataTrigger Binding="{Binding IsBatchRenameTabSelected}" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="15,8">
                <iconPacks:PackIconMaterial Kind="RenameBox" Width="20" Height="20" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
                <TextBlock Text="Batch Rename" FontSize="14" FontWeight="SemiBold" Margin="8,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
              </StackPanel>
            </Border>

            <!-- Separator -->
            <Border Grid.Column="3" Width="1" Height="30" Background="#404040" />

            <!-- Organizer Tab -->
            <Border Grid.Column="4" Cursor="Hand" Background="Transparent" CornerRadius="5" Margin="5,0">
              <Border.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding SelectOrganizerTabCommand}" />
              </Border.InputBindings>
              <Border.Style>
                <Style TargetType="Border">
                  <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </Trigger>
                    <DataTrigger Binding="{Binding IsOrganizerTabSelected}" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="15,8">
                <iconPacks:PackIconMaterial Kind="FolderStar" Width="20" Height="20" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
                <TextBlock Text="Smart Organizer" FontSize="14" FontWeight="SemiBold" Margin="8,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
              </StackPanel>
            </Border>

            <!-- Separator -->
            <Border Grid.Column="5" Width="1" Height="30" Background="#404040" />

            <!-- Space Recovery Tab -->
            <Border Grid.Column="6" Cursor="Hand" Background="Transparent" CornerRadius="5" Margin="5,0">
              <Border.InputBindings>
                <MouseBinding MouseAction="LeftClick" Command="{Binding SelectSpaceRecoveryTabCommand}" />
              </Border.InputBindings>
              <Border.Style>
                <Style TargetType="Border">
                  <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </Trigger>
                    <DataTrigger Binding="{Binding IsSpaceRecoveryTabSelected}" Value="True">
                      <Setter Property="Background" Value="{DynamicResource ButtonHoverBackground}" />
                    </DataTrigger>
                  </Style.Triggers>
                </Style>
              </Border.Style>
              <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="15,8">
                <iconPacks:PackIconMaterial Kind="HarddiskPlus" Width="20" Height="20" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
                <TextBlock Text="Space Recovery" FontSize="14" FontWeight="SemiBold" Margin="8,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
              </StackPanel>
            </Border>
          </Grid>
        </Border>

        <!-- Content Area -->
        <Border Margin="10,65,10,10" Background="{DynamicResource CardBackground}" CornerRadius="8" Padding="10">
          <ContentControl Content="{Binding CurrentView}">
            <ContentControl.Resources>
              <DataTemplate DataType="{x:Type viewModels:DualPaneBrowserViewModel}">
                <views:DualPaneBrowserView />
              </DataTemplate>
              <DataTemplate DataType="{x:Type viewModels:BatchRenameViewModel}">
                <views:BatchRenameView />
              </DataTemplate>
              <DataTemplate DataType="{x:Type viewModels:OrganizerViewModel}">
                <views:OrganizerView />
              </DataTemplate>
            </ContentControl.Resources>
          </ContentControl>
        </Border>

        <!-- Loading Overlay -->
        <Border Background="#80000000" CornerRadius="10" Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
          <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
            <iconPacks:PackIconMaterial Kind="Loading" Width="48" Height="48" Foreground="{DynamicResource PrimaryTextColor}" Spin="True" />
            <TextBlock Text="Loading..." FontSize="16" Margin="0,10,0,0" Foreground="{DynamicResource PrimaryTextColor}" HorizontalAlignment="Center" />
          </StackPanel>
        </Border>
      </Grid>
    </Border>
  </Grid>
</UserControl>
