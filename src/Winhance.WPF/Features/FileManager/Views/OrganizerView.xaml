<UserControl x:Class="Winhance.WPF.Features.FileManager.Views.OrganizerView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:viewModels="clr-namespace:Winhance.WPF.Features.FileManager.ViewModels"
  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks" d:DataContext="{d:DesignInstance Type=viewModels:OrganizerViewModel}" mc:Ignorable="d">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- Source Selection -->
    <Border Grid.Row="0" Background="{DynamicResource CardBackground}" CornerRadius="8" Padding="15" Margin="0,0,0,10">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal">
          <TextBlock Text="Source:" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" Width="80" />
          <TextBox Text="{Binding SourcePath, Mode=TwoWay}" Width="400" Height="32" VerticalContentAlignment="Center" Background="{DynamicResource MainContainerBorderBrush}" Foreground="{DynamicResource PrimaryTextColor}" />
          <Button Content="Browse..." Width="80" Height="32" Margin="10,0,0,0" Style="{DynamicResource SecondaryButtonStyle}" />
          <TextBlock Text="{Binding TotalFiles, StringFormat='{}{0} files'}" FontSize="14" Margin="20,0,0,0" VerticalAlignment="Center" Foreground="{DynamicResource AccentColor}" />
          <TextBlock Text="|" FontSize="14" Margin="10,0" VerticalAlignment="Center" Foreground="{DynamicResource SubTextColor}" />
          <TextBlock FontSize="14" VerticalAlignment="Center" Foreground="{DynamicResource SubTextColor}">
            <TextBlock.Text>
              <MultiBinding StringFormat="{}{0:N0} bytes">
                <Binding Path="TotalSize" />
              </MultiBinding>
            </TextBlock.Text>
          </TextBlock>
        </StackPanel>

        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,15,0,0">
          <TextBlock Text="Strategy:" FontSize="14" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" Width="80" />
          <RadioButton Content="By File Type" IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=ByType}" Margin="0,0,20,0" Foreground="{DynamicResource PrimaryTextColor}" />
          <RadioButton Content="By Date" IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=ByDate}" Margin="0,0,20,0" Foreground="{DynamicResource PrimaryTextColor}" />
          <RadioButton Content="By Project" IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=ByProject}" Margin="0,0,20,0" Foreground="{DynamicResource PrimaryTextColor}" />
          <RadioButton Content="By Size" IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=BySize}" Margin="0,0,20,0" Foreground="{DynamicResource PrimaryTextColor}" />
          <RadioButton Content="AI Category" IsChecked="{Binding SelectedStrategy, Converter={StaticResource EnumBooleanConverter}, ConverterParameter=ByAICategory}" Foreground="{DynamicResource PrimaryTextColor}" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- Destination -->
    <Border Grid.Row="1" Background="{DynamicResource CardBackground}" CornerRadius="8" Padding="15" Margin="0,0,0,10">
      <StackPanel Orientation="Horizontal">
        <TextBlock Text="Destination:" FontSize="14" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" Width="80" />
        <RadioButton Content="Same folder with subfolders" IsChecked="{Binding MoveToSameFolder}" Margin="0,0,20,0" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
        <RadioButton Content="Move to:" IsChecked="{Binding MoveToSameFolder, Converter={StaticResource InverseBooleanConverter}}" Margin="0,0,10,0" VerticalAlignment="Center" Foreground="{DynamicResource PrimaryTextColor}" />
        <TextBox Text="{Binding DestinationPath, Mode=TwoWay}" Width="300" Height="28" IsEnabled="{Binding MoveToSameFolder, Converter={StaticResource InverseBooleanConverter}}" VerticalContentAlignment="Center" Background="{DynamicResource MainContainerBorderBrush}" Foreground="{DynamicResource PrimaryTextColor}" />
      </StackPanel>
    </Border>

    <!-- Preview Section -->
    <Border Grid.Row="2" Background="{DynamicResource CardBackground}" CornerRadius="8" Padding="15">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto" />
          <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <TextBlock Grid.Row="0" Text="ORGANIZATION PREVIEW" FontSize="12" FontWeight="Bold" Foreground="{DynamicResource SubTextColor}" Margin="0,0,0,10" />

        <TreeView Grid.Row="1" ItemsSource="{Binding Categories}" Background="Transparent" BorderThickness="0">
          <TreeView.ItemTemplate>
            <HierarchicalDataTemplate>
              <Grid Margin="5">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="*" />
                  <ColumnDefinition Width="Auto" />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <CheckBox Grid.Column="0" IsChecked="{Binding IsSelected}" Margin="0,0,10,0" VerticalAlignment="Center" />

                <iconPacks:PackIconMaterial Grid.Column="1" Kind="Folder" Width="20" Height="20" Margin="0,0,10,0" VerticalAlignment="Center" Foreground="{DynamicResource AccentColor}" />

                <StackPanel Grid.Column="2" Orientation="Vertical">
                  <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="SemiBold" Foreground="{DynamicResource PrimaryTextColor}" />
                  <TextBlock Text="{Binding DestinationFolder}" FontSize="11" Foreground="{DynamicResource SubTextColor}" />
                </StackPanel>

                <TextBlock Grid.Column="3" Text="{Binding FileCount, StringFormat='{}{0} files'}" FontSize="12" Margin="20,0" VerticalAlignment="Center" Foreground="{DynamicResource SubTextColor}" />

                <TextBlock Grid.Column="4" Text="{Binding SizeDisplay}" FontSize="12" VerticalAlignment="Center" Foreground="{DynamicResource AccentColor}" />
              </Grid>
            </HierarchicalDataTemplate>
          </TreeView.ItemTemplate>
        </TreeView>

        <!-- Empty State -->
        <StackPanel Grid.Row="1" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding Categories.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
          <iconPacks:PackIconMaterial Kind="FolderSearch" Width="64" Height="64" Foreground="{DynamicResource SubTextColor}" HorizontalAlignment="Center" />
          <TextBlock Text="Click 'Analyze' to preview organization" FontSize="16" Margin="0,15,0,0" Foreground="{DynamicResource SubTextColor}" HorizontalAlignment="Center" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- Action Buttons -->
    <Border Grid.Row="3" Background="{DynamicResource MainContainerBorderBrush}" CornerRadius="8" Padding="15" Margin="0,10,0,0">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <!-- Left Side - Info -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
          <TextBlock Text="{Binding StatusMessage}" FontSize="14" Foreground="{DynamicResource SubTextColor}" />
        </StackPanel>

        <!-- Right Side - Buttons -->
        <StackPanel Grid.Column="1" Orientation="Horizontal">
          <Button Content="Analyze" Width="100" Height="35" Margin="0,0,10,0" Command="{Binding AnalyzeCommand}" Style="{DynamicResource SecondaryButtonStyle}" />
          <Button Content="Preview Changes" Width="120" Height="35" Margin="0,0,10,0" Style="{DynamicResource SecondaryButtonStyle}" />
          <Button Content="Apply Organization" Width="140" Height="35" Margin="0,0,10,0" Command="{Binding ApplyOrganizationCommand}" Style="{DynamicResource PrimaryButtonStyle}" />
          <Button Content="Undo" Width="80" Height="35" Command="{Binding UndoOrganizationCommand}" IsEnabled="{Binding CanUndo}" Style="{DynamicResource SecondaryButtonStyle}" />
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>
