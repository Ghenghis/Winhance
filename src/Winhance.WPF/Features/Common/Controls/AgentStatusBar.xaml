<UserControl x:Class="Winhance.WPF.Features.Common.Controls.AgentStatusBar"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks" Height="28">

  <Border Background="{DynamicResource StatusBarBackground}" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0">
    <Grid>
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
      </Grid.ColumnDefinitions>

      <!-- Agent Status Icon -->
      <Border Grid.Column="0" Padding="8,0" VerticalAlignment="Center">
        <StackPanel Orientation="Horizontal">
          <iconPacks:PackIconMaterial Kind="RobotHappy" Width="14" Height="14" VerticalAlignment="Center" Foreground="{Binding StatusColor}" Margin="0,0,6,0"/>
          <TextBlock Text="{Binding CurrentAgentName}" FontSize="11" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="{DynamicResource TextForeground}" Visibility="{Binding HasActiveTask, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </StackPanel>
      </Border>

      <!-- Current Action -->
      <TextBlock Grid.Column="1" Text="{Binding CurrentAction}" FontSize="11" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextForeground}" TextTrimming="CharacterEllipsis" Margin="4,0"/>

      <!-- Progress Bar -->
      <Border Grid.Column="2" Width="120" Margin="8,0" VerticalAlignment="Center" Visibility="{Binding HasActiveTask, Converter={StaticResource BooleanToVisibilityConverter}}">
        <Grid>
          <ProgressBar Value="{Binding ProgressPercentage}" Maximum="100" Height="12" Background="{DynamicResource ProgressBarBackground}" Foreground="{DynamicResource AccentColor}"/>
          <TextBlock Text="{Binding ProgressText}" FontSize="9" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="{DynamicResource TextForeground}"/>
        </Grid>
      </Border>

      <!-- Timer Display -->
      <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="8,0" Visibility="{Binding HasActiveTask, Converter={StaticResource BooleanToVisibilityConverter}}">
        <iconPacks:PackIconMaterial Kind="Timer" Width="12" Height="12" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextForeground}" Margin="0,0,4,0"/>
        <TextBlock FontSize="11" VerticalAlignment="Center" Foreground="{DynamicResource TextForeground}">
          <Run Text="{Binding ElapsedTime}"/>
          <Run Text=" / " Foreground="{DynamicResource SecondaryTextForeground}"/>
          <Run Text="{Binding EstimatedTimeRemaining}"/>
        </TextBlock>
      </StackPanel>

      <!-- Queue Count -->
      <Border Grid.Column="4" Margin="8,0" Visibility="{Binding QueueCount, Converter={StaticResource IntToVisibilityConverter}}">
        <StackPanel Orientation="Horizontal">
          <iconPacks:PackIconMaterial Kind="PlaylistPlay" Width="12" Height="12" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextForeground}" Margin="0,0,4,0"/>
          <TextBlock FontSize="11" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextForeground}">
            <Run Text="{Binding QueueCount}"/>
            <Run Text=" queued"/>
          </TextBlock>
        </StackPanel>
      </Border>

      <!-- Pause/Resume Button -->
      <Button Grid.Column="5" Command="{Binding PauseCurrentTaskCommand}" Style="{StaticResource IconButtonStyle}" Width="24" Height="24" Margin="2,0" ToolTip="{Binding IsPaused, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Resume|Pause'}" Visibility="{Binding CanPause, Converter={StaticResource BooleanToVisibilityConverter}}">
        <iconPacks:PackIconMaterial Kind="{Binding IsPaused, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Play|Pause'}" Width="12" Height="12"/>
      </Button>

      <!-- Cancel Button -->
      <Button Grid.Column="6" Command="{Binding CancelCurrentTaskCommand}" Style="{StaticResource IconButtonStyle}" Width="24" Height="24" Margin="2,0,8,0" ToolTip="Cancel" Visibility="{Binding CanCancel, Converter={StaticResource BooleanToVisibilityConverter}}">
        <iconPacks:PackIconMaterial Kind="Close" Width="12" Height="12"/>
      </Button>
    </Grid>
  </Border>
</UserControl>
